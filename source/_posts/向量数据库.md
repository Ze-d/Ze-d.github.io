---
title: 向量数据库
date: 2025-12-15 20:32:53
tags: Database,Vector-Database
---

## 1) 向量数据库是什么

向量数据库（Vector Database）可以理解为：**专门用来存储、索引和查询“向量嵌入（embeddings）”的数据系统**，支持用“相似度”去检索内容（kNN/ANN），并且通常还能结合**结构化元数据过滤**、做**水平扩展**等工程能力。([Google Cloud](https://cloud.google.com/discover/what-is-a-vector-database?utm_source=chatgpt.com))

> 向量嵌入：把文本/图片/音频/代码等非结构化数据，用模型编码成一个固定维度的数值向量；语义越接近，向量在空间里越“近”。([Elastic](https://www.elastic.co/docs/solutions/search/vector/dense-vector?utm_source=chatgpt.com))

------

## 2) 它是怎么工作的（核心机制）

一个典型的向量检索链路如下：

```
原始数据 → 切分/清洗 → Embedding模型 → 向量(+metadata)写入
      → 建索引(ANN) → 查询向量 → 近邻搜索(kNN/ANN) + 过滤 + 排序/重排
```

关键点有 4 个：

1. **相似度度量**：常见是 L2（欧氏距离）、IP（内积）、Cosine（余弦）。([Milvus](https://milvus.io/docs/index.md?utm_source=chatgpt.com))
2. **近邻搜索**：规模大时通常用**近似最近邻（ANN）**，在“延迟/吞吐/内存/召回率”之间做权衡。([Yugabyte](https://www.yugabyte.com/blog/what-is-a-vector-database/?utm_source=chatgpt.com))
3. **索引结构**：常见包括 HNSW、IVF、PQ 等（不同产品实现细节不同）。Milvus 例如就支持 FLAT、IVF_FLAT、IVF_PQ、HNSW 等索引族。([Milvus](https://milvus.io/docs/index.md?utm_source=chatgpt.com))
4. **过滤与混合检索**：工程里几乎一定要“向量相似 + 条件过滤（metadata）”，很多系统还会把向量检索与 BM25/全文检索融合做 **Hybrid Search**。([Weaviate 文档](https://docs.weaviate.io/weaviate/concepts/filtering?utm_source=chatgpt.com))

------

## 3) 优势（为什么要用）

- **语义检索能力强**：不依赖关键词完全匹配，适合问答检索、RAG、相似内容召回。([Google Cloud](https://cloud.google.com/discover/what-is-a-vector-database?utm_source=chatgpt.com))
- **大规模近邻检索性能好**：通过 ANN 索引避免全表扫描。([Yugabyte](https://www.yugabyte.com/blog/what-is-a-vector-database/?utm_source=chatgpt.com))
- **结构化过滤 + 语义检索融合**：例如 Weaviate 支持“带过滤条件的向量检索”，Redis 也强调向量检索可与多种元数据过滤结合。([Weaviate 文档](https://docs.weaviate.io/weaviate/concepts/filtering?utm_source=chatgpt.com))
- **混合检索更稳**：Hybrid（向量 + BM25/稀疏检索）能兼顾“语义相关”和“关键词精确命中”。([Weaviate 文档](https://docs.weaviate.io/weaviate/search/hybrid?utm_source=chatgpt.com))

------

## 4) 利弊与常见坑（上线前必须知道）

- **“近似”带来不确定性**：ANN 不是严格精确最近邻，召回率受索引与参数影响（需要压测与调参）。([Yugabyte](https://www.yugabyte.com/blog/what-is-a-vector-database/?utm_source=chatgpt.com))
- **内存/存储成本可能很高**：向量维度高、数据量大时，HNSW 等索引会显著吃内存；很多产品引入量化/byte vector 来降低占用（例如 Elasticsearch 提到 byte 向量）。([Elastic](https://www.elastic.co/docs/solutions/search/vector/knn?utm_source=chatgpt.com))
- **更新/删除更复杂**：频繁 upsert、删除会影响索引质量与性能，有些系统需要重建或段合并策略（实现差异很大）。
- **过滤会改变性能曲线**：向量检索 + 严格过滤可能让召回/延迟变差，因此一些系统专门优化“可过滤索引”（如 Qdrant 解释向量索引 + payload 索引协同）。([qdrant.tech](https://qdrant.tech/documentation/concepts/indexing/?utm_source=chatgpt.com))
- **效果高度依赖 embedding 质量**：模型变更会导致“向量空间漂移”，需要重算与回填策略（版本化字段、双写、灰度）。

------

## 5) 操作方法（你实际怎么用）

### 5.1 数据建模（最常见形态）

每条记录通常长这样：

- `id`：唯一标识
- `vector`：embedding 向量（如 384/768/1536 维）
- `metadata/payload`：结构化字段（来源、时间、权限、标签、数值特征等）
- `text/chunk`：可选，原文或摘要（用于展示/重排）

### 5.2 基本 CRUD + 建索引 + 查询

通用操作集：

1. **创建集合/索引（collection/index）**：声明向量维度、距离度量、索引类型与参数
2. **写入/更新（upsert）**：`(id, vector, metadata)`
3. **查询（search）**：给定 query vector，返回 topK 相似记录
4. **过滤（filter）**：如 `tenant_id=... AND lang='zh' AND time>...`
5. **混合检索（hybrid）**：向量结果 + BM25 结果融合/加权/重排 ([Weaviate 文档](https://docs.weaviate.io/weaviate/search/hybrid?utm_source=chatgpt.com))

### 5.3 两个“最常用落地姿势”

**A. 专用向量库做召回（推荐召回层）**

- 用向量库做 TopK 召回 + 过滤
- 再接一个 reranker/业务规则做重排
- 最终给 LLM（RAG）或推荐/搜索结果页

**B. 在现有数据库/搜索引擎里启用向量能力（减少系统数量）**

- 例如 PostgreSQL + pgvector（HNSW/IVFFlat）([GitHub](https://github.com/pgvector/pgvector?utm_source=chatgpt.com))
- Elasticsearch / OpenSearch 的向量字段与 kNN 查询 ([Elastic](https://www.elastic.co/docs/solutions/search/vector/knn?utm_source=chatgpt.com))
- MongoDB Atlas Vector Search（`$vectorSearch`）([MongoDB](https://www.mongodb.com/docs/atlas/atlas-vector-search/tutorials/vector-search-quick-start/?utm_source=chatgpt.com))
- Redis 向量检索并可配合多类型过滤 ([Redis](https://redis.io/docs/latest/develop/ai/search-and-query/vectors/?utm_source=chatgpt.com))

------

## 6) 和其他数据库类型对比（怎么选）

| 类型                                 | 强项                       | 弱项                                  | 典型场景                                                     |
| ------------------------------------ | -------------------------- | ------------------------------------- | ------------------------------------------------------------ |
| 关系型（MySQL/PostgreSQL）           | 强一致事务、复杂关联、报表 | 不擅长语义相似检索（需扩展/外置系统） | 业务主库、OLTP                                               |
| 文档库（MongoDB）                    | JSON 灵活、开发快          | 语义检索需向量索引能力支持            | 内容/日志/配置；加向量后可做 RAG                             |
| 搜索引擎（Elasticsearch/OpenSearch） | 全文检索、聚合、倒排生态   | 事务弱；向量检索调参与资源占用要评估  | 站内搜索、日志检索、混合检索                                 |
| 图数据库（Neo4j）                    | 关系/路径查询强            | 不是纯向量检索最优形态                | 图关系 + 向量语义联合分析 ([Graph Database & Analytics](https://neo4j.com/docs/cypher-manual/current/indexes/semantic-indexes/vector-indexes/?utm_source=chatgpt.com)) |
| 专用向量数据库                       | 向量检索/过滤/扩展专精     | 系统多一套、数据一致性与回填要设计    | 语义搜索、推荐召回、RAG                                      |

------

## 7) 目前主流向量数据库/方案（按类别）

### 专用向量数据库（最常见）

- **Milvus（开源）**：支持多种 ANN 索引（FLAT/IVF/HNSW/PQ…），面向大规模向量检索。([Milvus](https://milvus.io/docs/index.md?utm_source=chatgpt.com))
- **Weaviate（开源）**：强调“向量检索 + 结构化过滤 + 混合检索”。([Weaviate 文档](https://docs.weaviate.io/weaviate/concepts/filtering?utm_source=chatgpt.com))
- **Qdrant（开源）**：突出 payload（元数据）过滤与索引协同。([qdrant.tech](https://qdrant.tech/documentation/concepts/indexing/?utm_source=chatgpt.com))
- **Pinecone（托管）**：商业化托管向量库，文档中提供 hybrid search 指南。([Pinecone 文档](https://docs.pinecone.io/guides/search/hybrid-search?utm_source=chatgpt.com))

### “传统系统加向量能力”（降低引入成本）

- **PostgreSQL + pgvector**：用扩展提供向量相似检索，支持 HNSW/IVFFlat 索引。([GitHub](https://github.com/pgvector/pgvector?utm_source=chatgpt.com))
- **Elasticsearch**：`dense_vector` 字段 + kNN 检索能力。([Elastic](https://www.elastic.co/docs/solutions/search/vector/knn?utm_source=chatgpt.com))
- **OpenSearch**：`knn_vector` 字段 + k-NN 插件查询能力。([OpenSearch 文档](https://docs.opensearch.org/latest/mappings/supported-field-types/knn-vector/?utm_source=chatgpt.com))
- **MongoDB Atlas Vector Search**：通过 `$vectorSearch` 做 ANN/ENN，并支持过滤字段。([MongoDB](https://www.mongodb.com/docs/atlas/atlas-vector-search/vector-search-overview/?utm_source=chatgpt.com))
- **Redis Vector Search**：提供向量字段与语义检索，并可配合多种元数据过滤。([Redis](https://redis.io/docs/latest/develop/ai/search-and-query/vectors/?utm_source=chatgpt.com))
- **Neo4j Vector Index**：图结构上做向量相似检索（常用于“图关系 + 语义”组合）。([Graph Database & Analytics](https://neo4j.com/docs/cypher-manual/current/indexes/semantic-indexes/vector-indexes/?utm_source=chatgpt.com))

### 轻量/本地开发常见

- **Chroma（开源）**：面向 AI 应用开发的向量数据库（本地起步非常快）。([Chroma Docs](https://docs.trychroma.com/getting-started?utm_source=chatgpt.com))

------

## 8) 快速选型建议（最实用的几条）

- **你已经有 Elasticsearch/OpenSearch 做站内搜索**：优先尝试在原体系做“全文 + 向量”的混合检索，系统最省。([Elastic](https://www.elastic.co/docs/solutions/search/vector/knn?utm_source=chatgpt.com))
- **你主库是 PostgreSQL，数据量中等且想少引系统**：pgvector 是高性价比路线。([GitHub](https://github.com/pgvector/pgvector?utm_source=chatgpt.com))
- **你要做大规模语义召回/RAG（百万到十亿级向量）**：优先专用向量库（Milvus/Weaviate/Qdrant）或托管（Pinecone），再通过 metadata 做权限与租户隔离。([Milvus](https://milvus.io/docs/index.md?utm_source=chatgpt.com))

如果你告诉我：**数据量级（向量条数）、向量维度、是否多租户/权限过滤、QPS/延迟目标、你现有技术栈（Postgres/ES/Redis/Mongo）**，我可以直接给你一份更贴近你场景的“架构图 + 选型对比 + 参数调优清单”。
