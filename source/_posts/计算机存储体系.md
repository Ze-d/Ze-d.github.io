---
title: 计算机存储体系
date: 2026-01-05 20:02:58
tags:
---

## 1. 核心总览：存储金字塔

## ![](https://raw.githubusercontent.com/Ze-d/blog-img/main/licensed-image.jpg)

这个金字塔决定了计算机的性能极限。数据只有被搬运到金字塔的**塔尖**，才能被 CPU 计算。

| **层级** | **硬件名称**           | **物理材料**        | **速度 (延迟)**               | **典型容量**  | **角色**   |
| -------- | ---------------------- | ------------------- | ----------------------------- | ------------- | ---------- |
| **L0**   | **寄存器 (Registers)** | 触发器 (Flip-flop)  | **0 cycles** (即时)           | < 1 KB        | 厨师的手   |
| **L1**   | **L1 Cache**           | SRAM (静态随机存取) | **~4 cycles** (1ns)           | 64 KB         | 案板       |
| **L2**   | **L2 Cache**           | SRAM                | **~12 cycles** (4ns)          | 256 KB - 1MB  | 料理台     |
| **L3**   | **L3 Cache**           | SRAM                | **~40 cycles** (15ns)         | 10 MB - 64 MB | 厨房冰箱   |
| **L4**   | **内存 (RAM)**         | DRAM (动态随机存取) | **~300 cycles** (100ns)       | 16 GB - 64 GB | 社区超市   |
| **L5**   | **SSD 硬盘**           | NAND Flash (闪存)   | **~10,000+ cycles** (100µs)   | 512 GB - 2 TB | 远郊仓库   |
| **L6**   | **HDD 机械硬盘**       | 磁性碟片            | **~10,000,000 cycles** (10ms) | 4 TB+         | 海外集装箱 |

------

## 2. 详细拆解：每一层的工作原理

### 2.1 CPU 内部的特权阶级：SRAM 家族 (Registers & Caches)

这些存储单元直接集成在 CPU 芯片内部，造价极其昂贵（占用宝贵的晶圆面积）。

- **寄存器 (Registers):**
  - **是什么：** CPU 运算单元 (ALU) 只能对寄存器里的数据做计算。
  - **特点：** 就在 ALU 旁边，没有地址概念，通过名字访问（如 `RAX`, `RBX`）。
- **缓存 (L1/L2/L3 Cache):**
  - **材料：** **SRAM (Static RAM)**。它使用 **6 个晶体管** 来存储 1 bit 数据。
  - **优点：** 只要通电数据就在，不需要刷新，速度极快。
  - **缺点：** 密度低（体积大），死贵。
  - **通信方式：**
    - **L1/L2** 是核心私有的，通过 CPU 内部的高速信号线互联。
    - **L3** 是共享的，通过**环形总线 (Ring Bus)** 或 **网格网络 (Mesh Interconnect)** 在多核之间传递数据。

### 2.2 核心工作区：主内存 (Main Memory / RAM)

当 CPU 需要处理大量数据时，Cache 放不下，就必须用到内存。

- **材料：** **DRAM (Dynamic RAM)**。
- **原理：** 它使用 **1 个晶体管 + 1 个电容** 来存储 1 bit。
  - 电容会漏电！所以必须每隔几毫秒就给它充电一次，这叫**“刷新” (Refresh)**。
  - 正因为要刷新，所以它比 SRAM 慢（忙着刷新的时候不能读写）。
- **通信通道：** **内存总线 (Memory Bus)**。
  - 以前内存控制器在北桥芯片里。
  - 现在内存控制器 **(IMC - Integrated Memory Controller)** 直接集成在 CPU 里面，通过主板上的电路直连内存条。

### 2.3 数据归宿：辅助存储 (Storage / Disk)

这里是断电后数据依然存在的地方。

- **SSD (固态硬盘):**
  - **材料：** NAND Flash（浮栅晶体管）。通过电子被困在栅极里来存数据。
  - **通信：** 走 **PCIe 通道 (NVMe 协议)**，直连 CPU 或通过 PCH（南桥）转发，速度极快（几 GB/s）。
- **HDD (机械硬盘):**
  - **材料：** 磁性碟片 + 机械磁头。
  - **通信：** 走 **SATA 接口**，通常连接到 PCH（南桥芯片），速度慢（几百 MB/s）。

------

## 3. 它们之间是如何通信的？（总线与控制器）

这是一个关于“连接”的故事。计算机内部有一张复杂的交通网。

### 3.1 核心角色

1. **CPU (中央处理器):** 整个系统的指挥官。
2. **IMC (内存控制器):** 现在集成在 CPU 肚子里，专门负责指挥内存条。
3. **PCH (平台控制器/南桥):** 这是一个“集线器”，负责连接慢速设备（硬盘、USB、网卡、声卡），然后再通过一根极细但极快的数据管子（如 DMI 总线）连给 CPU。

### 3.2 关键技术：DMA (直接内存访问)

这是计算机高效率的核心秘密。

- 没有 DMA 时：

  如果要从硬盘读取 1GB 电影到内存，CPU 必须亲自搬运：读硬盘 -> 进 CPU 寄存器 -> 写内存。搬运 10 亿次，CPU 累死，什么也干不了。

- 有了 DMA (Direct Memory Access)：

  CPU 发一条命令给硬盘控制器：“把这 1GB 数据搬到内存地址 X，搬完了告诉我。”

  然后 CPU 就去打游戏了。

  硬盘控制器直接通过总线把数据写进内存，完全不经过 CPU。

  搬完后，发一个中断 (Interrupt) 信号通知 CPU：“老板，活干完了”。

------

## 4. 实例演示：当你打开一个 20GB 的游戏时发生了什么？

让我们追踪数据流，看这些组件如何协作：

1. **点击图标 (硬盘 -> 内存):**
   - 你双击游戏图标。
   - CPU 通知 SSD 硬盘：“把游戏的核心文件加载出来”。
   - SSD 利用 **DMA 技术**，通过 **PCIe 总线**，疯狂地把数据写入 **DRAM (内存)**。此时数据还在 L4 层级。
2. **预处理 (内存 -> L3 -> L2 -> L1):**
   - 游戏代码准备运行。CPU 预取器 (Prefetcher) 发现你要运行代码了。
   - 数据从 **内存** 被拉入 **L3 Cache** (共享)。
   - 调度到某个核心，数据进入 **L2** 和 **L1**。
3. **计算 (L1 -> 寄存器 -> ALU):**
   - CPU 的解码单元读取指令。
   - 数据进入 **寄存器**。
   - ALU 进行物理碰撞计算、AI 逻辑运算。
4. **回写 (寄存器 -> ... -> 内存):**
   - 算好的结果（比如你现在的血量变了），先写回 **L1**。
   - 经过 **Store Buffer** 和 **MESI 协议** 的广播，数据最终同步回 **L3** 和 **内存**。
   - 如果需要存档，CPU 再次叫醒 SSD，把内存里的进度写入硬盘。

------

## 5. 总结：性能瓶颈表

| **组件关系**    | **通信带宽 (Bandwidth)** | **典型延迟 (Latency)** | **瓶颈比喻**      |
| --------------- | ------------------------ | ---------------------- | ----------------- |
| **L1 <-> CPU**  | 极高 (1000+ GB/s)        | 1 ns                   | 伸手拿菜          |
| **L3 <-> CPU**  | 高 (数百 GB/s)           | 15 ns                  | 去冰箱拿          |
| **RAM <-> CPU** | 中 (50-100 GB/s)         | 100 ns                 | 叫外卖 (瓶颈所在) |
| **SSD <-> RAM** | 低 (3-7 GB/s)            | 100 µs (100,000 ns)    | 淘宝发货          |
| **HDD <-> RAM** | 极低 (0.2 GB/s)          | 10 ms (10,000,000 ns)  | 海运              |

最终结论：

计算机的整个存储设计，本质上就是在**“掩盖慢速设备的延迟”**。

- 用 L1/L2/L3 掩盖 RAM 的慢。
- 用 RAM 掩盖 硬盘 的慢。
- **所有的软件优化（缓存算法、预取、索引），都是为了让数据尽可能地留在金字塔的顶端。**

## 6.附录：计算机架构图

![](https://raw.githubusercontent.com/Ze-d/blog-img/main/unnamed.jpg)
